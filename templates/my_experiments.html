{% extends "base.html" %}
{% block title %}–ú–æ–∏ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>üìä –ú–æ–∏ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏</h2>
        <p class="text-muted">
            <strong>{{ user_name }}</strong> |
            <span class="badge bg-{{ 'primary' if user_role == 'teacher' else 'success' }}">
                {{ '–ü—Ä–æ—Ñ–µ—Å–æ—Ä' if user_role == 'teacher' else '–°—Ç—É–¥–µ–Ω—Ç' }}
            </span>
        </p>
    </div>
</div>

{% if experiments %}
<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
<div class="row mt-3">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h3 class="text-success">{{ experiments|map(attribute='product')|unique|list|length }}</h3>
                <p class="text-muted mb-0">–†–∞–∑–ª–∏—á–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h3 class="text-warning">{{ experiments|selectattr('safety_warning')|list|length }}</h3>
                <p class="text-muted mb-0">–°–æ –ø—Ä–µ–¥—É–ø—Ä–µ–¥—É–≤–∞—ö–∞</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h3 class="text-info">
                    {% if experiments[0].participation_timestamp %}
                    {{ experiments[0].participation_timestamp.strftime('%d.%m') }}
                    {% elif experiments[0].time_stamp %}
                    {{ experiments[0].time_stamp.strftime('%d.%m') }}
                    {% endif %}
                </h3>
                <p class="text-muted mb-0">–ü–æ—Å–ª–µ–¥–µ–Ω –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç</p>
            </div>
        </div>
    </div>
</div>

<!-- –õ–∏—Å—Ç–∞ –Ω–∞ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏ -->
<div class="row mt-4">
    {% for experiment in experiments %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-gradient" style="background: linear-gradient(45deg, #667eea, #764ba2);">
                <div class="d-flex justify-content-between align-items-center text-white">
                    <span><i class="bi bi-flask"></i> –ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç #{{ experiment.experiment_id }}</span>
                    <small>
                        {% if experiment.participation_timestamp %}
                        {{ experiment.participation_timestamp.strftime('%d.%m.%Y') }}
                        {% elif experiment.time_stamp %}
                        {{ experiment.time_stamp.strftime('%d.%m.%Y') }}
                        {% endif %}
                    </small>
                </div>
            </div>
            <div class="card-body">
                <!-- –†–µ–∞–∫—Ü–∏—ò–∞ -->
                <div class="reaction-equation text-center mb-3 p-3 bg-light rounded">
                    <strong style="font-size: 18px; color: #764ba2;">
                        {{ experiment.element1_symbol }} + {{ experiment.element2_symbol }} ‚Üí {{ experiment.product }}
                    </strong>
                </div>

                <!-- –î–µ—Ç–∞–ª–∏ -->
                <div class="experiment-details">
                    <p class="mb-2">
                        <strong>–†–µ–∞–∫—Ç–∞–Ω—Ç–∏:</strong><br>
                        <span class="text-muted">{{ experiment.element1_name }} + {{ experiment.element2_name }}</span>
                    </p>

                    <p class="mb-2">
                        <strong>–£—Å–ª–æ–≤–∏:</strong><br>
                        <span class="text-muted">{{ experiment.conditions or '–°—Ç–∞–Ω–¥–∞—Ä–¥–Ω–∏ —É—Å–ª–æ–≤–∏' }}</span>
                    </p>

                    <p class="mb-2">
                        <strong>–†–µ–∑—É–ª—Ç–∞—Ç:</strong><br>
                        <span class="text-muted">{{ experiment.result[:80] }}{% if experiment.result|length > 80 %}...{%
                            endif %}</span>
                    </p>

                    {% if experiment.safety_warning %}
                    <div class="alert alert-warning py-2 px-2 mb-2">
                        <small><strong>‚ö†Ô∏è –ë–µ–∑–±–µ–¥–Ω–æ—Å—Ç:</strong> {{ experiment.safety_warning }}</small>
                    </div>
                    {% endif %}

                    {% if experiment.participation_timestamp or experiment.time_stamp %}
                    <p class="text-muted text-center mt-3 mb-0">
                        <small>
                            <i class="bi bi-clock"></i>
                            {% if experiment.participation_timestamp %}
                            {{ experiment.participation_timestamp.strftime('%H:%M:%S') }}
                            {% else %}
                            {{ experiment.time_stamp.strftime('%H:%M:%S') }}
                            {% endif %}
                        </small>
                    </p>
                    {% endif %}
                    {% if experiment.equipment and experiment.equipment|length > 0 %}
                    <p class="mb-2">
                        <strong>–û–ø—Ä–µ–º–∞:</strong>
                    <ul class="small text-muted mb-0">
                        {% for eq in experiment.equipment %}
                        <li>
                            {{ eq.equipment_name }}
                            {% if eq.type %}<span class="text-secondary">({{ eq.type }})</span>{% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                    </p>
                    {% else %}
                    <p class="mb-2">
                        <strong>–û–ø—Ä–µ–º–∞:</strong>
                        <span class="text-muted">–ù–µ–º–∞ –µ–≤–∏–¥–µ–Ω—Ç–∏—Ä–∞–Ω–∞ –æ–ø—Ä–µ–º–∞</span>
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<!-- –ù–µ–º–∞ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏ -->
<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-info text-center">
            <h4>üìö –ù–µ–º–∞—Ç–µ –∏–∑–≤—Ä—à–µ–Ω–æ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏</h4>
            <p>–ó–∞–ø–æ—á–Ω–µ—Ç–µ —Å–æ –∫–æ—Ä–∏—Å—Ç–µ—ö–µ –Ω–∞ –≤–∏—Ä—Ç—É–µ–ª–Ω–∞—Ç–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—ò–∞ –∑–∞ –¥–∞ —Å–æ–∑–¥–∞–¥–µ—Ç–µ –≤–∞—à–∏ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏.</p>
            <a href="/laboratory" class="btn btn-primary">üî¨ –û—Ç–≤–æ—Ä–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—ò–∞</a>
        </div>
    </div>
</div>
{% endif %}

<div class="mt-4 text-center">
    <a href="/dashboard" class="btn btn-secondary">üè† Dashboard</a>
    <a href="/laboratory" class="btn btn-success">‚ûï –ù–æ–≤ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç</a>
    {% if user_role == 'teacher' %}
    <a href="/experiments" class="btn btn-info">üìã –°–∏—Ç–µ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏</a>
    {% endif %}
</div>
{% endblock %}